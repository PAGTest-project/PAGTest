[{"strategy": "retry", "code": "\npackage org.ice4j.stack;\n\nimport org.junit.jupiter.api.Test;\nimport org.mockito.Mockito;\n\nimport java.util.ArrayList;\nimport java.util.Hashtable;\n\nimport static org.mockito.Mockito.*;\n\npublic class StunStack_shutDownTest {\n\n    @Test\n    public void testShutDown() {\n        // Given\n        StunStack stunStack = Mockito.spy(new StunStack());\n        doReturn(new Hashtable<>()).when(stunStack).clientTransactions;\n        doReturn(new Hashtable<>()).when(stunStack).serverTransactions;\n\n        StunClientTransaction clientTransaction = mock(StunClientTransaction.class);\n        StunServerTransaction serverTransaction = mock(StunServerTransaction.class);\n\n        stunStack.clientTransactions.put(mock(TransactionID.class), clientTransaction);\n        stunStack.serverTransactions.put(mock(TransactionID.class), serverTransaction);\n\n        ExpiredServerTransactionsCollector expiredTransactionsCollector = mock(ExpiredServerTransactionsCollector.class);\n        NetAccessManager netAccessManager = mock(NetAccessManager.class);\n\n        doReturn(expiredTransactionsCollector).when(stunStack).expiredTransactionsCollector;\n        doReturn(netAccessManager).when(stunStack).netAccessManager;\n\n        // When\n        stunStack.shutDown();\n\n        // Then\n        verify(stunStack.eventDispatcher).removeAllListeners();\n        verify(clientTransaction).cancel();\n        verify(serverTransaction).expire();\n        verify(expiredTransactionsCollector).cancel();\n        verify(netAccessManager).stop();\n    }\n}\n"}]