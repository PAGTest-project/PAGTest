[{"strategy": "retry", "code": "\npackage org.jsoup.helper;\n\nimport org.junit.jupiter.api.Test;\nimport org.w3c.dom.Document;\nimport org.w3c.dom.DocumentType;\nimport javax.xml.transform.TransformerException;\nimport java.util.HashMap;\nimport java.util.Map;\n\nimport static org.junit.jupiter.api.Assertions.assertEquals;\nimport static org.junit.jupiter.api.Assertions.assertThrows;\n\npublic class W3CDom_asStringTest {\n\n    @Test\n    public void testAsString_WithPropertiesAndDoctype() throws Exception {\n        // Given\n        Document doc = W3CDom.convert(org.jsoup.Jsoup.parse(\"<!DOCTYPE html><html><head><title>Test</title></head><body><p>Hello, World!</p></body></html>\"));\n        Map<String, String> properties = new HashMap<>();\n        properties.put(\"method\", \"html\");\n\n        // When\n        String result = W3CDom.asString(doc, properties);\n\n        // Then\n        assertEquals(\"<!DOCTYPE html>\\n<html>\\n <head>\\n  <title>Test</title>\\n </head>\\n <body>\\n  <p>Hello, World!</p>\\n </body>\\n</html>\", result);\n    }\n\n    @Test\n    public void testAsString_WithDoctypeHtmlLegacy() throws Exception {\n        // Given\n        Document doc = W3CDom.convert(org.jsoup.Jsoup.parse(\"<!DOCTYPE html><html><head><title>Test</title></head><body><p>Hello, World!</p></body></html>\"));\n\n        // When\n        String result = W3CDom.asString(doc, null);\n\n        // Then\n        assertEquals(\"<!DOCTYPE html SYSTEM \\\"about:legacy-compat\\\">\\n<html>\\n <head>\\n  <title>Test</title>\\n </head>\\n <body>\\n  <p>Hello, World!</p>\\n </body>\\n</html>\", result);\n    }\n\n    @Test\n    public void testAsString_TransformerException() {\n        // Given\n        Document doc = W3CDom.convert(org.jsoup.Jsoup.parse(\"<html><head><title>Test</title></head><body><p>Hello, World!</p></body></html>\"));\n        Map<String, String> properties = new HashMap<>();\n        properties.put(\"invalidProperty\", \"invalidValue\");\n\n        // When & Then\n        assertThrows(IllegalStateException.class, () -> W3CDom.asString(doc, properties));\n    }\n}\n"}]