[{"strategy": "generate", "code": "\npackage org.ice4j.stack;\n\nimport org.ice4j.*;\nimport org.ice4j.message.*;\nimport org.ice4j.socket.*;\nimport org.junit.jupiter.api.*;\nimport static org.junit.jupiter.api.Assertions.*;\n\npublic class StunStack_sendRequestTest {\n    private StunStack stunStack;\n    private TransportAddress clientAddress;\n    private TransportAddress serverAddress;\n    private Request bindingRequest;\n    private Response bindingResponse;\n    private PlainRequestCollector requestCollector;\n    private PlainResponseCollector responseCollector;\n\n    @BeforeEach\n    public void setUp() throws Exception {\n        stunStack = new StunStack();\n\n        IceSocketWrapper clientSock = new IceUdpSocketWrapper(\n            new SafeCloseDatagramSocket(new InetSocketAddress(\"127.0.0.1\", 0)));\n        IceSocketWrapper serverSock = new IceUdpSocketWrapper(\n            new SafeCloseDatagramSocket(new InetSocketAddress(\"127.0.0.1\", 0)));\n\n        clientAddress = new TransportAddress(\"127.0.0.1\", clientSock.getLocalPort(), Transport.UDP);\n        serverAddress = new TransportAddress(\"127.0.0.1\", serverSock.getLocalPort(), Transport.UDP);\n\n        stunStack.addSocket(clientSock);\n        stunStack.addSocket(serverSock);\n\n        bindingRequest = MessageFactory.createBindingRequest();\n        bindingResponse = MessageFactory.create3489BindingResponse(\n            clientAddress, clientAddress, serverAddress);\n\n        requestCollector = new PlainRequestCollector();\n        responseCollector = new PlainResponseCollector();\n    }\n\n    @Test\n    public void testSendRequestSuccess() throws Exception {\n        stunStack.addRequestListener(serverAddress, requestCollector);\n\n        TransactionID transactionID = stunStack.sendRequest(\n            bindingRequest, serverAddress, clientAddress, responseCollector);\n\n        assertNotNull(transactionID, \"TransactionID should not be null\");\n\n        requestCollector.waitForRequest();\n\n        StunMessageEvent evt = requestCollector.receivedRequests.get(0);\n        byte[] tid = evt.getMessage().getTransactionID();\n\n        stunStack.sendResponse(tid, bindingResponse, serverAddress, clientAddress);\n\n        responseCollector.waitForResponse();\n\n        assertEquals(1, responseCollector.receivedResponses.size(),\n            \"There should be one response received\");\n    }\n\n    @Test\n    public void testSendRequestFailure() throws Exception {\n        stunStack.addRequestListener(serverAddress, requestCollector);\n\n        Request invalidRequest = MessageFactory.createBindingRequest();\n        invalidRequest.addAttribute(new UnknownAttribute(0xFFFF));\n\n        assertThrows(IllegalArgumentException.class, () -> {\n            stunStack.sendRequest(invalidRequest, serverAddress, clientAddress, responseCollector);\n        }, \"IllegalArgumentException should be thrown for invalid request\");\n    }\n}\n"}]